<div class="table-container">
  <div *ngIf="errorMessage" class="error-message">
    <p class="center"><b>{{ errorMessage }}</b></p>
  </div>
    <table>
      <thead>
        <tr>
          <th class="narrow-column"></th>
          <th class="bordered-column">{{ title }}</th>
          <th class="bordered-column">Etape de croissance</th>
          <th class="bordered-column">Sommation vibration</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let syllable of vibrationResult.syllabes; let i = index">
          <td class="narrow-column">
            <div *ngFor="let letter of syllable.split('')">
              {{ letter }}
            </div>
          </td>

          <td class="bordered-column">
            <div *ngFor="let vibration of vibrationResult.vibration[i]">
              <div class="circleLarge" [ngStyle]="{'background-color': getColor(vibration.vibrationColor)}">
                <span>{{ getFormattedVibrationNumber(vibration) }}</span>
              </div>
              &nbsp;<span>{{ vibration.description }}</span>
            </div>
          </td>

          <td class="bordered-column">
            <div>
              <div *ngIf="vibrationResult.growthStage.stage[i] as vibrationNumber" class="circleWhiteLarge">{{ vibrationNumber }}</div>
              <div *ngFor="let detail of vibrationResult.growthStage.stageDetail[i]; let isLast = last">
                <div class="circleLarge" [ngStyle]="{'background-color': getColor(detail.vibrationColor)}">
                  <span>{{ getFormattedVibrationNumber(detail)}}</span>
                </div>
                &nbsp;<span>{{detail.description}}</span>
                <span *ngIf="!isLast" style="font-weight: bold;"> lie a </span>
              </div>
            </div>
          </td>

          <td
            class="bordered-column no-padding"
            *ngIf="i === 0"
            [attr.rowspan]="2"
          >
            <table>
              <tr></tr>
              <tr>
                <td>
                  <div class="circleWhiteLarge">{{vibrationResult.vibrationSummation.summation}}</div>
                  <div *ngFor="let detail of vibrationResult.vibrationSummation.summationDetail; let isLast = last">
                    <div class="circleLarge" [ngStyle]="{'background-color': getColor(detail.vibrationColor)}">
                      <span>{{ getFormattedVibrationNumber(detail)}}</span>
                    </div>
                    &nbsp;<span>{{detail.description}}</span>
                    <span *ngIf="!isLast" style="font-weight: bold;"> lie a </span>
                  </div>

                </td>
              </tr>
              <tr>
                <th>Tarot</th>
              </tr>
              <tr class="no-bottom-border">
                <td>{{ getSummationTarotExpression() }}</td>
              </tr>
              <tr class="no-bottom-border">
                <td>
                  <div class="tarot-card-preview" *ngIf="vibrationResult.vibrationTarot.tarotCard as tarotCard">
                    <img
                      *ngIf="getTarotImageUrl()"
                      class="tarot-card-image"
                      [src]="getTarotImageUrl()"
                      [alt]="tarotCard.name || 'Carte de tarot'"
                    />
                    <div class="tarot-card-description" *ngIf="tarotCard.description">
                      {{ tarotCard.description }}
                    </div>
                  </div>
                </td>
              </tr>
            </table>
          </td>
        </tr>
        <tr class="no-bottom-border" *ngIf="vibrationResult.vibrationAdvices.length">
          <th colspan="4" style="text-align: center;">Conseils</th>
        </tr>
        <tr class="no-bottom-border" *ngFor="let advice of vibrationResult.vibrationAdvices; let idx = index">
          <td colspan="4" style="text-align: left;">
            <div style="font-weight: bold; margin-bottom: 4px;">Conseil {{ idx + 1 }}:</div>
            <div class="advice-row">
              <div class="circleWhiteLarge">{{ advice.advice }}</div>
              <div class="advice-chain">
                <ng-container *ngFor="let detail of advice.adviceDetail; let isLast = last">
                  <div class="circleLarge" [ngStyle]="{'background-color': getColor(detail.vibrationColor)}">
                    <span>{{ getFormattedVibrationNumber(detail) }}</span>
                  </div>
                  <span>{{ detail.description }}</span>
                  <span *ngIf="!isLast" style="font-weight: bold; margin-right: 8px;"> lie a </span>
                </ng-container>
              </div>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
</div>

